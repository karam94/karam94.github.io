<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Running Entity Framework Core migrations from a separate solution that doesn&#x27;t contain a Startup.cs file. - Karam.io</title><meta name="gridsome:hash" content="6fe372bab11d0fceef4dd394fd3b9f44e24d1db3"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.21"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="I like writing code &amp; playing football. I&#x27;m terrible at both."><meta data-vue-tag="ssr" name="description" content="After an hour of tearing my hair out..."><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.fcfd982a4fc064582a158198eac8650c.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.fcfd982a4fc064582a158198eac8650c.png"><link rel="preload" href="/assets/css/0.styles.7e3a9afe.css" as="style"><link rel="preload" href="/assets/js/app.24c85096.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--post-vue.4ba5e1d2.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.d1a22b1b.js"><link rel="prefetch" href="/assets/js/page--src--pages--about-vue.b755caf4.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.9160a3aa.js"><link rel="prefetch" href="/assets/js/page--src--pages--reading-vue.06d29e12.js"><link rel="prefetch" href="/assets/js/page--src--pages--speaking-vue.ad8cd608.js"><link rel="prefetch" href="/assets/js/page--src--templates--tag-vue.5abffd0b.js"><link rel="stylesheet" href="/assets/css/0.styles.7e3a9afe.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <script>
      // Add dark / light detection that runs before Vue.js load. Borrowed from overreacted.io
      (function() {
        window.__onThemeChange = function() {};
        function setTheme(newTheme) {
          window.__theme = newTheme;
          preferredTheme = newTheme;
          document.body.setAttribute('data-theme', newTheme);
          window.__onThemeChange(newTheme);
        }

        var preferredTheme;
        try {
          preferredTheme = localStorage.getItem('theme');
        } catch (err) { }

        window.__setPreferredTheme = function(newTheme) {
          setTheme(newTheme);
          try {
            localStorage.setItem('theme', newTheme);
          } catch (err) {}
        }

        var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
        darkQuery.addListener(function(e) {
          window.__setPreferredTheme(e.matches ? 'dark' : 'light')
        });

        setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
      })();
    </script>

    <div id="app" data-server-rendered="true"><header class="header"><div class="header__left"><a href="/" class="logo active"><span class="logo__text"> ‚Üê Karam.io </span></a></div><div class="header__right"><div class="header__right__menu"><a href="/about/">About</a><a href="/reading/">Reading</a><a href="/speaking/">Speaking</a></div><button role="button" aria-label="Toggle dark/light" class="toggle-theme"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></button></div></header><main class="main"><div class="post-title"><h1 class="post-title__text">
      Running Entity Framework Core migrations from a separate solution that doesn't contain a Startup.cs file.
    </h1><div class="post-meta">25 May 2019 - 3 mins</div></div><div class="post content-box__post"><div class="post__header"><img alt="Cover image" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 860 574' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-da7ecb680eb188a82e9acd16c48028da'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='10'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-da7ecb680eb188a82e9acd16c48028da)' width='860' height='574' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAArAEADASIAAhEBAxEB/8QAGgABAAIDAQAAAAAAAAAAAAAABgUHAgMEAP/EADEQAAIBAgQEBAUDBQAAAAAAAAECAwQRAAUSIQYTMUEUIlFhB0JxgZEjQ7FigqHB8P/EABkBAAMAAwAAAAAAAAAAAAAAAAMEBQECBv/EACYRAAEEAQQABgMAAAAAAAAAAAEAAgMEERIhMUETI1FxgcEFFNH/2gAMAwEAAhEDEQA/AMOCKtpslcUUEoykPLSoWUaS4fSzA9Re/Q9vvjHjOSal8XWQUisArUpcxs2pF3Qrp9yd/XHbxLlObQ5RWV%2bWlJaeapNVLTUsgBZrI3MUfMx6sg77j0xXWTeP4x4g8PR8xoWYTVVOJeVGyg2J237i5O%2b/tgVjIOCmaeBgjgcqb%2bH1KsWVc2TQKiqe533IXa%2b%2b/qcJmYEXRlYHoVN74j6So8NXUNPTvD4CVy8bHUAAgYEANtbbfobYU0FBBV1NDO6wMC7VEmkjSiMAota9yO%2bwBN/TBatzDQzTsEl%2bQoGWQy69z1hS%2bTTQxfDtJ1kUnxEsbkMDoJNt/Sxt%2bcTEjxS%2bEanuY2p0YHSQDt7/AMYNU6Q0NPBBSDlwRt4nRqHmitbmEL0uT369Da2NrVMWXP8ApWghZJWdwwsj62GrSCdRGkdrC5uemGw/VvhJGvpAGUf4yUycQsEcI8YUg/VBjVk2Vy1FTE0XkgikBaU%2bxvYfjCoUOU1iha2nSedb2mLEtp1MFZmuCRYdd79sHOJ8wqciynMpqR6OhoqZSyu7nmEkEqqruLk9ycTJqjg8ynhXa11ro21wdwFIZBBXZRNFBIlNV0UEmiKPlhZI1u/W5t5tQBbrtfc4j6bJnyqbxctPlsFdXySgmmpzAY42t5Cx3bzKLk%2boPfG3hqvOb0Ymng5cx5sU5J3QXNnKk7g6fseg649nfEtLAiPTMy8leY8pXWkQCgA26hre5ubb74AZCW4KN4YDshB%2bJOHYGShmE1RTOrSBYljB1kyEW62Nz3GGGV5UlNCsaVBEZHnAU3c/1EtuPbBLifOoxn%2bXx8wOsVLHJZFN2kkuxNjv8xP92EL5ytJl61HImqNwNEQu31%2bmLVaFgga/tc5bsSfsuZ10kdBSR0fOkhqZzPIoXXJZrWFtvaxO2MJqOeTQWzasszrqtHFta5X5el/ybE9MTdDkwB5lRPFUrYELC11NxexOI/NBOOakNDDEwNolSo1Frb%2bYEbb9%2bmBPsRsfoTMdSaSMybKBzOkhWeRGjWZUICKF5ekW2B09Rck7%2bpxXnF8cMDrDNFHNKsQKs41aL3FhfFkc0tUyOWDE2uQb9sVf8Qpr55Nf5VQDb2xIlke%2bUgk8q/ViYyIENHHonPHCV%2bU8RTvTz1PhqpFdmi2BYA3Yd79NvQkeuOGgyo5nDL4lohSKL1JdSCFHS57NuPN/wd/ElRLlzwyXMYlQgA2tfV3H0wT58tPDniROVSKgjKDrbyqO/wBT%2bcYe3DsBasfluSq842rIzxhJNFGkQnUNZRawBIA/AGE2QVbzaBAJJGVSSEBNgPW3bFoZb8POFa%2bsyyatyeKeQ0isTJI5BOx3Gqx6nCuGjpctkSiy%2blp6aldWVooolUMNDdbD2xYqTFkePRQrtZskpPGVAcGoxyWNmsA13%2bxO2DOe5jUz8Tzwgo2XxxAXNiTJc3t6WH84Q53US0WRyNStyyF2sBttivKaR2YMzEsdyT3wOCEWH639b/KYszGpF4cfe3x/V0mv0VciqhKFzdh0XFY8d1QmzyrAYHSVH%2bBhfWzSJO2hiP1rfbfFacSuzZ9W3P7g/wBYmlvnH3%2b1XiPkD2%2bl/9k=' /%3e%3c/svg%3e" width="860" data-src="/assets/static/campaign-creators-IKHvOlZFCOg-unsplash.07cc2b7.2b434c2735c3ca2606b41eba4d07664a.jpg" data-srcset="/assets/static/campaign-creators-IKHvOlZFCOg-unsplash.a67b0b2.2b434c2735c3ca2606b41eba4d07664a.jpg 480w, /assets/static/campaign-creators-IKHvOlZFCOg-unsplash.07cc2b7.2b434c2735c3ca2606b41eba4d07664a.jpg 860w" data-sizes="(max-width: 860px) 100vw, 860px" class="g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/campaign-creators-IKHvOlZFCOg-unsplash.07cc2b7.2b434c2735c3ca2606b41eba4d07664a.jpg" class="g-image g-image--loaded" width="860" alt="Cover image"></noscript><div class="post__header-credits">
        Image credits: <span><a href='https://unsplash.com/@campaign_creators'>Campaign Creators</a></span></div></div><div class="post__content"><h2 id="a-painful-introduction"><a href="#a-painful-introduction" aria-hidden="true"><span class="icon icon-link"></span></a>A painful introduction</h2>
<p>I'll keep this one short as I currently need to figure out a way to stick my hair back on the  my head, after wasting the last hour tearing it all out.</p>
<p>Basically, I'm currently in the middle of building a new side project using .NET Core.
I'm trying to apply a Clean Architecture approach to it, avoiding your typical repository pattern approach but utilising EF Core with Identity as my persistence layer.</p>
<p>Resultantly, this therefore meant that my migrations and DbContext had to live in a separate project to my Web API project which acts as a presentation layer and this caused some hiccups which I'll try to point out below.</p>
<h2 id="prerequisites"><a href="#prerequisites" aria-hidden="true"><span class="icon icon-link"></span></a>Prerequisites</h2>
<p>Firstly, we must ensure that our AddDbContext in our Startup.cs class of our Web API project is pointing at the separate project which contains our actual DbContext implementation.</p>
<pre class="language-csharp"><code class="language-csharp">  services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContext</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>YourDbContext<span class="token punctuation">></span></span></span><span class="token punctuation">(</span>options <span class="token operator">=></span>
    options<span class="token punctuation">.</span><span class="token function">UseSqlServer</span><span class="token punctuation">(</span>Configuration<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">"YourConnectionString"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x <span class="token operator">=></span> x<span class="token punctuation">.</span><span class="token function">MigrationsAssembly</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">YourDbContext</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">.</span>FullName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="dotnet-ef-migrations-add-initialmigrations"><a href="#dotnet-ef-migrations-add-initialmigrations" aria-hidden="true"><span class="icon icon-link"></span></a>dotnet ef migrations add InitialMigrations</h2>
<p>Usually when our DbContext exists within the same project as our Startup file, it takes a couple of seconds to generate and add our initial migrations via the awesome CLI that gets shipped with EF Core.</p>
<p>However, in this scenario, I ran in to a couple of issues:</p>
<p>After running the migrations add command in my Web API project...</p>
<pre class="language-bash"><code class="language-bash">info: Microsoft.EntityFrameworkCore.Infrastructure<span class="token punctuation">[</span><span class="token number">10403</span><span class="token punctuation">]</span>
      Entity Framework Core <span class="token number">2.2</span>.4-servicing-10062 initialized <span class="token string">'CleanstagramDbContext'</span> using provider <span class="token string">'Microsoft.EntityFrameworkCore.SqlServer'</span> with options: <span class="token assign-left variable">MigrationsAssembly</span><span class="token operator">=</span>Cleanstagram.Persistence
Your target project <span class="token string">'Cleanstagram.Web'</span> doesn<span class="token string">'t match your migrations assembly '</span>Cleanstagram.Persistence<span class="token string">'. Either change your target project or change your migrations assembly.
Change your migrations assembly by using DbContextOptionsBuilder. E.g. options.UseSqlServer(connection, b => b.MigrationsAssembly("Cleanstagram.Web")). By default, the migrations assembly is the assembly containing the DbContext.
Change your target project to the migrations project by using the Package Manager Console'</span>s Default project drop-down list, or by executing <span class="token string">"dotnet ef"</span> from the directory containing the migrations project.</code></pre>
<p>So this error was confusing as it was clear that it had picked up that my DbContext lived in a separate project. But fortunately it pointed me in the direction of changing my target project in the Package Manager console. So I did.</p>
<p>Unfortunately after changing my target project/root directory in regular cmd/bash, this resulted in a separate error...</p>
<pre class="language-bash"><code class="language-bash">Unable to create an object of <span class="token builtin class-name">type</span> <span class="token string">'CleanstagramDbContext'</span><span class="token builtin class-name">.</span> For the different patterns supported at design time, see https://go.microsoft.com/fwlink/?linkid<span class="token operator">=</span><span class="token number">851728</span></code></pre>
<p>I was baffled, so I tried to add an OnModelCreating() override within my IdentityDbContext inheriting DbContext to see if it would help and to an extent it did. To a certain extent...</p>
<pre class="language-bash"><code class="language-bash">System.InvalidOperationException: The entity <span class="token builtin class-name">type</span> <span class="token string">'IdentityUserLogin&lt;string>'</span> requires a primary key to be defined.
   at Microsoft.EntityFrameworkCore.Infrastructure.ModelValidator.ValidateNonNullPrimaryKeys<span class="token punctuation">(</span>IModel model<span class="token punctuation">)</span>
   at Microsoft.EntityFrameworkCore.Infrastructure.ModelValidator.Validate<span class="token punctuation">(</span>IModel model<span class="token punctuation">)</span>
   at Microsoft.EntityFrameworkCore.Infrastructure.RelationalModelValidator.Validate<span class="token punctuation">(</span>IModel model<span class="token punctuation">)</span>
   at Microsoft.EntityFrameworkCore.Internal.SqlServerModelValidator.Validate<span class="token punctuation">(</span>IModel model<span class="token punctuation">)</span>
   at Microsoft.EntityFrameworkCore.Metadata.Conventions.Internal.ValidatingConvention.Apply<span class="token punctuation">(</span>InternalModelBuilder modelBuilder<span class="token punctuation">)</span>
   at Microsoft.EntityFrameworkCore.Metadata.Conventions.Internal.ConventionDispatcher.ImmediateConventionScope.OnModelBuilt<span class="token punctuation">(</span>InternalModelBuilder modelBuilder<span class="token punctuation">)</span>
   at <span class="token punctuation">..</span>.
The entity <span class="token builtin class-name">type</span> <span class="token string">'IdentityUserLogin&lt;string>'</span> requires a primary key to be defined.</code></pre>
<p>But whilst it helped, it just ended up digging me down a deeper hole.</p>
<p>So, the solution?</p>
<pre class="language-bash"><code class="language-bash">dotnet ef migrations <span class="token function">add</span> InitialMigration --startup-project ./Cleanstagram.Web/ --project ./Cleanstagram.Persistence/</code></pre>
<p>I had to go up a level to the parent of both projects and then specify both as shown above. A startup project and another project which specifies where the DbContext in this case lives. Straight away after running this, just by magic, my migrations were generated and I resultantly followed it up with a dotnet ef database update.</p>
<p>This isn't much and it might be obvious to some, but judging from the hoarding of googling that I was going through, it was quite a common issue without a specific one size fits all solution that is easy to find online. So hopefully this helps some other poor sod out there.</p>
<p>Thanks for reading!</p>
</div><div class="post__footer"><div class="post-tags"><a href="/blog/tag/.NET%20Core/" class="post-tags__link"><span>#</span> .NET Core
  </a></div></div></div><div><div class="coffee__container"><h4>Enjoyed this blog post? üòÑ</h4><a href="https://www.buymeacoffee.com/karam" target="_blank"><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee :)&emoji=&slug=karam&button_colour=FFDD00&font_colour=000000&font_family=Comic&outline_colour=000000&coffee_colour=ffffff"></a></div></div><div class="post-comments"><div class="content-box__comments"><div id="disqus_thread" identifier="Running Entity Framework Core migrations from a separate solution that doesn't contain a Startup.cs file." style="min-height:200px;"></div></div></div></main><footer class="footer"><span>Made with
      <span style="color: red"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="heart" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-heart fa-w-16"><path fill="currentColor" d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"></path></svg></span>
      in wet &amp; rainy
      <a href="//en.wikipedia.org/wiki/Lancashire" target="_blank">Lancashire</a>!</span><br><span>¬© Copyright 2021 -
      <a href="//karam.io">Karam.io</a></span></footer></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"title":"Running Entity Framework Core migrations from a separate solution that doesn't contain a Startup.cs file.","path":"\u002Fblog\u002F2019\u002Frunning-entity-framework-core-migrations-from-a-separate-solution-that-doesn-t-contain-a-startup-cs-file\u002F","date":"25 May 2019","timeToRead":3,"tags":[{"id":".NET Core","title":".NET Core","path":"\u002Fblog\u002Ftag\u002F.NET%20Core\u002F"}],"description":"After an hour of tearing my hair out...","content":"\u003Ch2 id=\"a-painful-introduction\"\u003E\u003Ca href=\"#a-painful-introduction\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EA painful introduction\u003C\u002Fh2\u003E\n\u003Cp\u003EI'll keep this one short as I currently need to figure out a way to stick my hair back on the  my head, after wasting the last hour tearing it all out.\u003C\u002Fp\u003E\n\u003Cp\u003EBasically, I'm currently in the middle of building a new side project using .NET Core.\nI'm trying to apply a Clean Architecture approach to it, avoiding your typical repository pattern approach but utilising EF Core with Identity as my persistence layer.\u003C\u002Fp\u003E\n\u003Cp\u003EResultantly, this therefore meant that my migrations and DbContext had to live in a separate project to my Web API project which acts as a presentation layer and this caused some hiccups which I'll try to point out below.\u003C\u002Fp\u003E\n\u003Ch2 id=\"prerequisites\"\u003E\u003Ca href=\"#prerequisites\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EPrerequisites\u003C\u002Fh2\u003E\n\u003Cp\u003EFirstly, we must ensure that our AddDbContext in our Startup.cs class of our Web API project is pointing at the separate project which contains our actual DbContext implementation.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-csharp\"\u003E\u003Ccode class=\"language-csharp\"\u003E  services\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token generic-method\"\u003E\u003Cspan class=\"token function\"\u003EAddDbContext\u003C\u002Fspan\u003E\u003Cspan class=\"token generic class-name\"\u003E\u003Cspan class=\"token punctuation\"\u003E&lt;\u003C\u002Fspan\u003EYourDbContext\u003Cspan class=\"token punctuation\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eoptions \u003Cspan class=\"token operator\"\u003E=\u003E\u003C\u002Fspan\u003E\n    options\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EUseSqlServer\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EConfiguration\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EGetConnectionString\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"YourConnectionString\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E x \u003Cspan class=\"token operator\"\u003E=\u003E\u003C\u002Fspan\u003E x\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EMigrationsAssembly\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword\"\u003Etypeof\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token type-expression class-name\"\u003EYourDbContext\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EAssembly\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EFullName\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"dotnet-ef-migrations-add-initialmigrations\"\u003E\u003Ca href=\"#dotnet-ef-migrations-add-initialmigrations\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003Edotnet ef migrations add InitialMigrations\u003C\u002Fh2\u003E\n\u003Cp\u003EUsually when our DbContext exists within the same project as our Startup file, it takes a couple of seconds to generate and add our initial migrations via the awesome CLI that gets shipped with EF Core.\u003C\u002Fp\u003E\n\u003Cp\u003EHowever, in this scenario, I ran in to a couple of issues:\u003C\u002Fp\u003E\n\u003Cp\u003EAfter running the migrations add command in my Web API project...\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Einfo: Microsoft.EntityFrameworkCore.Infrastructure\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E10403\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\n      Entity Framework Core \u003Cspan class=\"token number\"\u003E2.2\u003C\u002Fspan\u003E.4-servicing-10062 initialized \u003Cspan class=\"token string\"\u003E'CleanstagramDbContext'\u003C\u002Fspan\u003E using provider \u003Cspan class=\"token string\"\u003E'Microsoft.EntityFrameworkCore.SqlServer'\u003C\u002Fspan\u003E with options: \u003Cspan class=\"token assign-left variable\"\u003EMigrationsAssembly\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003ECleanstagram.Persistence\nYour target project \u003Cspan class=\"token string\"\u003E'Cleanstagram.Web'\u003C\u002Fspan\u003E doesn\u003Cspan class=\"token string\"\u003E't match your migrations assembly '\u003C\u002Fspan\u003ECleanstagram.Persistence\u003Cspan class=\"token string\"\u003E'. Either change your target project or change your migrations assembly.\nChange your migrations assembly by using DbContextOptionsBuilder. E.g. options.UseSqlServer(connection, b =\u003E b.MigrationsAssembly(\"Cleanstagram.Web\")). By default, the migrations assembly is the assembly containing the DbContext.\nChange your target project to the migrations project by using the Package Manager Console'\u003C\u002Fspan\u003Es Default project drop-down list, or by executing \u003Cspan class=\"token string\"\u003E\"dotnet ef\"\u003C\u002Fspan\u003E from the directory containing the migrations project.\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003ESo this error was confusing as it was clear that it had picked up that my DbContext lived in a separate project. But fortunately it pointed me in the direction of changing my target project in the Package Manager console. So I did.\u003C\u002Fp\u003E\n\u003Cp\u003EUnfortunately after changing my target project\u002Froot directory in regular cmd\u002Fbash, this resulted in a separate error...\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003EUnable to create an object of \u003Cspan class=\"token builtin class-name\"\u003Etype\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E'CleanstagramDbContext'\u003C\u002Fspan\u003E\u003Cspan class=\"token builtin class-name\"\u003E.\u003C\u002Fspan\u003E For the different patterns supported at design time, see https:\u002F\u002Fgo.microsoft.com\u002Ffwlink\u002F?linkid\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E851728\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EI was baffled, so I tried to add an OnModelCreating() override within my IdentityDbContext inheriting DbContext to see if it would help and to an extent it did. To a certain extent...\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003ESystem.InvalidOperationException: The entity \u003Cspan class=\"token builtin class-name\"\u003Etype\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E'IdentityUserLogin&lt;string\u003E'\u003C\u002Fspan\u003E requires a primary key to be defined.\n   at Microsoft.EntityFrameworkCore.Infrastructure.ModelValidator.ValidateNonNullPrimaryKeys\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EIModel model\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n   at Microsoft.EntityFrameworkCore.Infrastructure.ModelValidator.Validate\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EIModel model\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n   at Microsoft.EntityFrameworkCore.Infrastructure.RelationalModelValidator.Validate\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EIModel model\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n   at Microsoft.EntityFrameworkCore.Internal.SqlServerModelValidator.Validate\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EIModel model\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n   at Microsoft.EntityFrameworkCore.Metadata.Conventions.Internal.ValidatingConvention.Apply\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EInternalModelBuilder modelBuilder\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n   at Microsoft.EntityFrameworkCore.Metadata.Conventions.Internal.ConventionDispatcher.ImmediateConventionScope.OnModelBuilt\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EInternalModelBuilder modelBuilder\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n   at \u003Cspan class=\"token punctuation\"\u003E..\u003C\u002Fspan\u003E.\nThe entity \u003Cspan class=\"token builtin class-name\"\u003Etype\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E'IdentityUserLogin&lt;string\u003E'\u003C\u002Fspan\u003E requires a primary key to be defined.\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EBut whilst it helped, it just ended up digging me down a deeper hole.\u003C\u002Fp\u003E\n\u003Cp\u003ESo, the solution?\u003C\u002Fp\u003E\n\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003Edotnet ef migrations \u003Cspan class=\"token function\"\u003Eadd\u003C\u002Fspan\u003E InitialMigration --startup-project .\u002FCleanstagram.Web\u002F --project .\u002FCleanstagram.Persistence\u002F\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EI had to go up a level to the parent of both projects and then specify both as shown above. A startup project and another project which specifies where the DbContext in this case lives. Straight away after running this, just by magic, my migrations were generated and I resultantly followed it up with a dotnet ef database update.\u003C\u002Fp\u003E\n\u003Cp\u003EThis isn't much and it might be obvious to some, but judging from the hoarding of googling that I was going through, it was quite a common issue without a specific one size fits all solution that is easy to find online. So hopefully this helps some other poor sod out there.\u003C\u002Fp\u003E\n\u003Cp\u003EThanks for reading!\u003C\u002Fp\u003E\n","cover_image":{"type":"image","mimeType":"image\u002Fjpeg","src":"\u002Fassets\u002Fstatic\u002Fcampaign-creators-IKHvOlZFCOg-unsplash.07cc2b7.2b434c2735c3ca2606b41eba4d07664a.jpg","size":{"width":860,"height":574},"sizes":"(max-width: 860px) 100vw, 860px","srcset":["\u002Fassets\u002Fstatic\u002Fcampaign-creators-IKHvOlZFCOg-unsplash.a67b0b2.2b434c2735c3ca2606b41eba4d07664a.jpg 480w","\u002Fassets\u002Fstatic\u002Fcampaign-creators-IKHvOlZFCOg-unsplash.07cc2b7.2b434c2735c3ca2606b41eba4d07664a.jpg 860w"],"dataUri":"data:image\u002Fsvg+xml,%3csvg fill='none' viewBox='0 0 860 574' xmlns='http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg' xmlns:xlink='http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-da7ecb680eb188a82e9acd16c48028da'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='10'\u002F%3e%3c\u002Ffilter%3e%3c\u002Fdefs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-da7ecb680eb188a82e9acd16c48028da)' width='860' height='574' xlink:href='data:image\u002Fjpeg%3bbase64%2c\u002F9j\u002F2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj\u002F2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj\u002FwAARCAArAEADASIAAhEBAxEB\u002F8QAGgABAAIDAQAAAAAAAAAAAAAABgUHAgMEAP\u002FEADEQAAIBAgQEBAUDBQAAAAAAAAECAwQRAAUSIQYTMUEUIlFhB0JxgZEjQ7FigqHB8P\u002FEABkBAAMAAwAAAAAAAAAAAAAAAAMEBQECBv\u002FEACYRAAEEAQQABgMAAAAAAAAAAAEAAgMEERIhMUETI1FxgcEFFNH\u002F2gAMAwEAAhEDEQA\u002FAMOCKtpslcUUEoykPLSoWUaS4fSzA9Re\u002FQ9vvjHjOSal8XWQUisArUpcxs2pF3Qrp9yd\u002FXHbxLlObQ5RWV%2bWlJaeapNVLTUsgBZrI3MUfMx6sg77j0xXWTeP4x4g8PR8xoWYTVVOJeVGyg2J237i5O%2b\u002FtgVjIOCmaeBgjgcqb%2bH1KsWVc2TQKiqe533IXa%2b%2b\u002FqcJmYEXRlYHoVN74j6So8NXUNPTvD4CVy8bHUAAgYEANtbbfobYU0FBBV1NDO6wMC7VEmkjSiMAota9yO%2bwBN\u002FTBatzDQzTsEl%2bQoGWQy69z1hS%2bTTQxfDtJ1kUnxEsbkMDoJNt\u002FSxt%2bcTEjxS%2bEanuY2p0YHSQDt7\u002FAMYNU6Q0NPBBSDlwRt4nRqHmitbmEL0uT369Da2NrVMWXP8ApWghZJWdwwsj62GrSCdRGkdrC5uemGw\u002FVvhJGvpAGUf4yUycQsEcI8YUg\u002FVBjVk2Vy1FTE0XkgikBaU%2bxvYfjCoUOU1iha2nSedb2mLEtp1MFZmuCRYdd79sHOJ8wqciynMpqR6OhoqZSyu7nmEkEqqruLk9ycTJqjg8ynhXa11ro21wdwFIZBBXZRNFBIlNV0UEmiKPlhZI1u\u002FW5t5tQBbrtfc4j6bJnyqbxctPlsFdXySgmmpzAY42t5Cx3bzKLk%2boPfG3hqvOb0Ymng5cx5sU5J3QXNnKk7g6fseg649nfEtLAiPTMy8leY8pXWkQCgA26hre5ubb74AZCW4KN4YDshB%2bJOHYGShmE1RTOrSBYljB1kyEW62Nz3GGGV5UlNCsaVBEZHnAU3c\u002F1EtuPbBLifOoxn%2bXx8wOsVLHJZFN2kkuxNjv8xP92EL5ytJl61HImqNwNEQu31%2bmLVaFgga\u002Ftc5bsSfsuZ10kdBSR0fOkhqZzPIoXXJZrWFtvaxO2MJqOeTQWzasszrqtHFta5X5el\u002FybE9MTdDkwB5lRPFUrYELC11NxexOI\u002FNBOOakNDDEwNolSo1Frb%2bYEbb9%2bmBPsRsfoTMdSaSMybKBzOkhWeRGjWZUICKF5ekW2B09Rck7%2bpxXnF8cMDrDNFHNKsQKs41aL3FhfFkc0tUyOWDE2uQb9sVf8Qpr55Nf5VQDb2xIlke%2bUgk8q\u002FViYyIENHHonPHCV%2bU8RTvTz1PhqpFdmi2BYA3Yd79NvQkeuOGgyo5nDL4lohSKL1JdSCFHS57NuPN\u002Fwd\u002FElRLlzwyXMYlQgA2tfV3H0wT58tPDniROVSKgjKDrbyqO\u002FwBT%2bcYe3DsBasfluSq842rIzxhJNFGkQnUNZRawBIA\u002FAGE2QVbzaBAJJGVSSEBNgPW3bFoZb8POFa%2bsyyatyeKeQ0isTJI5BOx3Gqx6nCuGjpctkSiy%2blp6aldWVooolUMNDdbD2xYqTFkePRQrtZskpPGVAcGoxyWNmsA13%2bxO2DOe5jUz8Tzwgo2XxxAXNiTJc3t6WH84Q53US0WRyNStyyF2sBttivKaR2YMzEsdyT3wOCEWH639b\u002FKYszGpF4cfe3x\u002FV0mv0VciqhKFzdh0XFY8d1QmzyrAYHSVH%2bBhfWzSJO2hiP1rfbfFacSuzZ9W3P7g\u002FwBYmlvnH3%2b1XiPkD2%2bl\u002F9k=' \u002F%3e%3c\u002Fsvg%3e"},"cover_image_credits":"\u003Ca href='https:\u002F\u002Funsplash.com\u002F@campaign_creators'\u003ECampaign Creators\u003C\u002Fa\u003E"}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.24c85096.js" defer></script><script src="/assets/js/page--src--templates--post-vue.4ba5e1d2.js" defer></script>
  </body>
</html>