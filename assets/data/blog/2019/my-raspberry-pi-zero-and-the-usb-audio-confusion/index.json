{"hash":"609c449f7566d67d3cb4d8fe84a7a2641ad0f6e8","data":{"post":{"title":"My Raspberry Pi Zero & the USB Audio Confusion","path":"/blog/2019/my-raspberry-pi-zero-and-the-usb-audio-confusion/","date":"17 February 2019","timeToRead":4,"tags":[{"id":"Miscellaneous","title":"Miscellaneous","path":"/blog/tag/Miscellaneous/"}],"description":"So... I won a free Raspberry Pi Zero from Google! Then I bought some USB speakers for it and chaos ensued!","content":"<p>To cut a long story short, I won a FREE <a href=\"https://www.raspberrypi.org/products/raspberry-pi-zero/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Raspberry Pi Zero</a> from <a href=\"http://google.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Google</a> at <a href=\"https://ndc-london.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">NDC London</a> in one of the giveaways they were hosting. In all honesty, I'd never really acquainted myself much with Raspberry Pi's before this happened and always saw myself as someone who was more interested in the web development sphere as opposed to creating little gadgets like the famous <a href=\"https://www.raspberrypi.org/blog/magic-mirror/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">magic mirrors</a>.</p>\n<p>However, given that I won one for free, it seemed almost rude not to read up more about them and then come up with an idea of some sort to try and push its boundaries (which seemed right given that I won a Pi Zero - which is a smaller more limited and streamlined version of the original that is slightly less powerful).</p>\n<h2 id=\"so-what-did-i-create-with-my-raspberry-pi-zero\"><a href=\"#so-what-did-i-create-with-my-raspberry-pi-zero\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>So, what did I create with my Raspberry Pi Zero?</h2>\n<p>Being a C# fan, the first thing I obviously did - whilst trapped at London Euston station - was to see if I could run <a href=\"https://dotnet.microsoft.com/download\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">.NET Core</a> on it. Unfortunately the Raspberry Pi Zero's come with an ARM CPU chip as opposed to their more powerful daddy Pi counter-parts which meant that I could only run the <a href=\"https://www.mono-project.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Mono framework</a> on my Pi Zero. I wasn't too disheartened by this as at the end of the day, whilst the popularity of IoT devices within the .NET Core development world is only going to grow exponentially, this type of scenario was exactly what Mono was initially made for.</p>\n<p>I created an application that queried a publicly facing API (it is one of the new Pi Zero W's so it has built in Wi-Fi) running on a job at midnight every day to fetch times and in return schedule jobs to play an audio file at those times. Simple, right?</p>\n<p>The foresight is to eventually add customisability to this where I can set an alarm every morning through my own created web interface (that I would probably access via my mobile phone) and then my Raspberry Pi Zero connected to a USB speaker would essentially become my alarm clock. Again, not very exciting but given my lack of creativity in terms of ideas, it was still a very fulfilling process to learn about how Raspberry Pi's work along with the <a href=\"https://www.raspberrypi.org/downloads/raspbian/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">NOOBS/Raspbian</a> eco-system the community has built around them alongside learning from some of the difficulties faced with installing Mono on the Pi (hint: it's not enough to just sudo apt get mono, you need mono-complete otherwise you get exceptions about core dependencies being unavailable such as System.Web... eek!) as well as the annoying issue that this post revolves around.</p>\n<h2 id=\"whats-the-audio-confusion-issue\"><a href=\"#whats-the-audio-confusion-issue\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>What's the Audio confusion issue?</h2>\n<p>As said in the previous section, my Mono application schedules different jobs to run at different times and play an audio file. I initially started out my implementation by using the original <a href=\"https://docs.microsoft.com/en-us/dotnet/api/system.media.soundplayer?view=netframework-4.7.2\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SoundPlayer</a> class that is found in the <a href=\"https://docs.microsoft.com/en-us/dotnet/framework/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">.NET Framework</a> and during development on my Windows machine within JetBrains Rider, this worked fine both in debug and release.</p>\n<p>However, upon running my application on my Raspberry Pi Zero... no luck. My application logs were suggesting that there were no exceptions being thrown or errors at hand, however whilst I could play the same audio files on my Pi in VLC Player, they just weren't being played when triggered through my application.</p>\n<p>It eventually became evident that there was clearly an incompatibility issue with the System.Media SoundPlayer class and my Raspberry Pi Zero. This meant I had to look for alternative ways to trigger a .wav file to be played on my Pi and I decided to just use the built in audio player within the operating system by triggering a bash command of \"aplay <em>name-of-file</em>.wav\". This worked.</p>\n<p>After thinking everything was dandy, I then realised that all this time, the audio I was hearing during testing on my Pi wasn't actually coming from the plugged in USB speakers. It was coming from the built-in speakers in my overhead projector that I was using as my Raspberry Pi Zero's monitor connected via HDMI! (I now have my Pi SSH'd on my main PC so I don't need to worry about a UI, but I left that until the end... silly me!)</p>\n<p>So, what was happening was that aplay configures itself at OS startup to match the settings within a configuration file (alsa.conf) that can be found at (/usr/share/alsa). By typing aplay -l (lowercase l, not uppercase), you get displayed all the recognised audio devices that aplay <em>could</em> potentially be outputting audio to.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">pi@raspberrypi:~ $ aplay -l\n**** List of PLAYBACK Hardware Devices ****\ncard <span class=\"token number\">0</span>: ALSA <span class=\"token punctuation\">[</span>bcm2835 ALSA<span class=\"token punctuation\">]</span>, device <span class=\"token number\">0</span>: bcm2835 ALSA <span class=\"token punctuation\">[</span>bcm2835 ALSA<span class=\"token punctuation\">]</span>\n  Subdevices: <span class=\"token number\">7</span>/7\n  Subdevice <span class=\"token comment\">#0: subdevice #0</span>\n  Subdevice <span class=\"token comment\">#1: subdevice #1</span>\n  Subdevice <span class=\"token comment\">#2: subdevice #2</span>\n  Subdevice <span class=\"token comment\">#3: subdevice #3</span>\n  Subdevice <span class=\"token comment\">#4: subdevice #4</span>\n  Subdevice <span class=\"token comment\">#5: subdevice #5</span>\n  Subdevice <span class=\"token comment\">#6: subdevice #6</span>\ncard <span class=\"token number\">0</span>: ALSA <span class=\"token punctuation\">[</span>bcm2835 ALSA<span class=\"token punctuation\">]</span>, device <span class=\"token number\">1</span>: bcm2835 ALSA <span class=\"token punctuation\">[</span>bcm2835 IEC958/HDMI<span class=\"token punctuation\">]</span>\n  Subdevices: <span class=\"token number\">1</span>/1\n  Subdevice <span class=\"token comment\">#0: subdevice #0</span>\ncard <span class=\"token number\">1</span>: Device <span class=\"token punctuation\">[</span>USB2.0 Device<span class=\"token punctuation\">]</span>, device <span class=\"token number\">0</span>: USB Audio <span class=\"token punctuation\">[</span>USB Audio<span class=\"token punctuation\">]</span>\n  Subdevices: <span class=\"token number\">1</span>/1\n  Subdevice <span class=\"token comment\">#0: subdevice #0</span></code></pre>\n<p>They are grouped by card and then by device. So in my case, the configuration file was set to card: 0 and device: 0 by default. This meant that aplay would always try to play audio to the default audio device within my Pi (even when none exists/is connected) as opposed to card: 1, device: 0 which was my USB speakers.</p>\n<pre class=\"language-json\"><code class=\"language-json\">defaults.pcm.card <span class=\"token number\">0</span> <span class=\"token comment\">// In my case, I changed this to 1.</span>\ndefaults.pcm.device <span class=\"token number\">0</span></code></pre>\n<p>Silly, right? Well, perhaps that's the wrong terminology to use. But it would be nice if this sort of thing <em>magically</em> correlated to the operating system's default audio output setting which in my case was set to not be HDMI.</p>\n<p>No idea if this will help anyone in the future? But I certainly would've liked Father Google to have blessed me with these minor pointers a week or so ago.</p>\n<p>Au revoir!</p>\n","cover_image":{"type":"image","mimeType":"image/jpeg","src":"/assets/static/harrison-broadbent-hSHNPyND_dU-unsplash.07cc2b7.5996aa4a3c02c6d466de62296f38df5a.jpg","size":{"width":860,"height":484},"sizes":"(max-width: 860px) 100vw, 860px","srcset":["/assets/static/harrison-broadbent-hSHNPyND_dU-unsplash.a67b0b2.5996aa4a3c02c6d466de62296f38df5a.jpg 480w","/assets/static/harrison-broadbent-hSHNPyND_dU-unsplash.07cc2b7.5996aa4a3c02c6d466de62296f38df5a.jpg 860w"],"dataUri":"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 860 484' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-5b291a26f13b3980c77f28e7c0d33083'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='10'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-5b291a26f13b3980c77f28e7c0d33083)' width='860' height='484' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAkAEADASIAAhEBAxEB/8QAGwAAAQUBAQAAAAAAAAAAAAAABwACBAUGAwj/xAAyEAACAQMCBAUCBAcBAAAAAAABAgMEBREAIQYSMWEHEyJBUXGRFDNSgRUjMjSCkrHR/8QAGAEAAwEBAAAAAAAAAAAAAAAAAQIDBAD/xAAjEQACAgEEAQUBAAAAAAAAAAABAgARAwQhMUESIlFhseHw/9oADAMBAAIRAxEAPwCu8SeJbbbaethhqoBVU3L5wDevLH8uMfrxkk9FHcjXnaouM1VXSzRxohcnlVRsg7Z/7pt0uNRdarzJuUHAAVRgDv8AX5OptrocYZhk65RURiO5ztttmmqYwf65GCj6k40T%2bJLPTy08UdrooVMDMjYUIWChR/lg5JY4O/wNZq2BIa2B2XIjBk/1Gf8AzWt4TnvFyt7zmSnEFO2SJIwQ%2bMMdvc9M9tHxBYGYtVlyIPJZjKyyVEJYS0s6FTgsnrUHGeoz7b6qZaM7hJFJ%2bDsdekpfCyuuVmt9VbqukhkkxUNEyMmC4BI6kfTYd86FVdHDJd6ygqKel8ylleCVo29HMGwcfuD220aHRkzqMuOjkTY/3zBrPSzL1jJ7jfUKZSpIYFSPYjB0SKmzUdOWaRH5i4Eao2VYZ656H6a63Omgq6iGERRzOzGPmJ5/TtjGcnO537baUkgy%2bPUo9VzLbxb8L14atdHf7RGWpECw1yAflnosg7Hoe%2bPnWFpShiBT40bOEPGG1XXhOvtnGtO0tSsLRMix/wB4D6SmOiv85wPfbpoHXBaW2cQVlBbqlqmgV%2banlZeVuRgCAw/UM4PcHRF9zU9HcS7t9uqK6huMlJDJNJHEFHKQAATkk57DV5wnDc6e2VEcVWqRmVVlhxvuN8N7bbE6fwdbEu1kkp6W4Rw1bPJJIpYZ5EUYUgnJDAscgEenfU%2bqEyXRqV0ppUCRRqxbMjEgegsANvcKASPvoBrO0wahbUh%2bPyv2FCh8a7TTk0lwtVZSSQjkUxlZFyBgbbEDYfOglbCGSaW4FDLLK0jNzHBLEsdx9dayuoKihlq0p6lKmJXkU%2bdEGQ8pwdt8Y6aHF6lhMVFBTsssiSMzqPSPMLhAv2B%2b%2biCvU501L0r/AFC3wNfrBa2n/jxdlnjVUeWm81NyS24B7awfFMdLcOOLqtGphtDP5sRgXkUIqbMAR7nJ0yGtlqKBJkeNWgdXCgbMFO%2bR7jp864VTXKENUwpSuJlAZXzkAdBv8DbSN7iUwBtsbDiM8aQjcY3Wvjijhm/GmBhEvKrhRjmI92ONz76x0n81lnfeXAGfnGlpaZOJqycyRDPLCyvFI6OBsyMVI/cak091rqSr/GR1UzTK6yHncsHK4IDb7jbGlpaaIQDsZp7Team70034lY1Jy5MYIyc5Od/nWR4epkul0poqssY355GCnGSAzD9sjS0tSHcu3Ky/kiSOqukcYCIxMmF2A9Q2GOg7a71k8hABOwUY%2b2lpampsTgPW0//Z' /%3e%3c/svg%3e"},"cover_image_credits":"<a href='https://unsplash.com/@harrisonbroadbent'>Harrison Broadbent</a>"}},"context":{}}